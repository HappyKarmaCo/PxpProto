<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game - Player</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 90%;
      max-width: 800px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    input, button {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      margin-top: 10px;
    }

    input {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
    }

    button {
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    button:hover {
      background: #45a049;
      transform: translateY(-2px);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .game-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin: 30px 0;
    }

    .game-button {
      height: 120px;
      font-size: 24px;
      font-weight: bold;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .game-button.selected {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      box-shadow: 0 0 20px rgba(79, 172, 254, 0.6);
    }

    .question-display {
      text-align: center;
      font-size: 36px;
      font-weight: bold;
      margin: 20px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
    }

    .timer {
      text-align: center;
      font-size: 48px;
      font-weight: bold;
      margin: 20px 0;
    }

    .round-info {
      text-align: center;
      font-size: 20px;
      margin-bottom: 20px;
    }

    .leaderboard {
      margin-top: 30px;
    }

    .leaderboard-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .leaderboard-item.highlight {
      background: rgba(255, 215, 0, 0.3);
      border: 2px solid gold;
    }

    .rank {
      font-size: 24px;
      font-weight: bold;
      width: 40px;
    }

    .player-info {
      flex: 1;
      margin-left: 15px;
    }

    .score {
      font-size: 24px;
      font-weight: bold;
    }

    .team-section {
      margin: 20px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    .team-list {
      margin-top: 15px;
    }

    .team-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .team-item button {
      width: auto;
      padding: 8px 15px;
      font-size: 14px;
      margin: 0;
    }

    .chat-section {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }

    .chat-message {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
    }

    .trash-talk-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }

    .trash-talk-buttons button {
      width: auto;
      padding: 10px 15px;
      font-size: 14px;
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .waiting {
      text-align: center;
      font-size: 20px;
      margin: 20px 0;
    }

    .cpu-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-left: 10px;
    }

    .player-header {
      background: rgba(255, 255, 255, 0.15);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .player-stat {
      text-align: center;
    }

    .player-stat-label {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .player-stat-value {
      font-size: 18px;
      font-weight: bold;
    }

    .result-screen {
      text-align: center;
    }

    .result-teams-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 30px;
    }

    .result-team {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
    }

    .result-team-header {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
    }

    .result-player {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: 0;
      transform: scale(0.8);
    }

    .result-player.reveal {
      animation: playerReveal 0.5s ease-out forwards;
    }

    @keyframes playerReveal {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .result-player.correct {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.3) 0%, rgba(56, 142, 60, 0.3) 100%);
      border: 2px solid #4CAF50;
    }

    .result-player.incorrect {
      background: linear-gradient(135deg, rgba(244, 67, 54, 0.3) 0%, rgba(211, 47, 47, 0.3) 100%);
      border: 2px solid #F44336;
    }

    .result-player-name {
      font-size: 20px;
      font-weight: bold;
    }

    .result-player-result {
      text-align: right;
    }

    .result-player-status {
      font-size: 18px;
      font-weight: bold;
    }

    .result-player-points {
      font-size: 24px;
      color: #FFD700;
      font-weight: bold;
    }

    .team-points-reveal {
      background: rgba(255, 215, 0, 0.2);
      padding: 20px;
      margin: 15px 0;
      border-radius: 10px;
      border: 2px solid #FFD700;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      opacity: 0;
      transform: scale(0.8);
    }

    .team-points-reveal.show {
      animation: teamPointsReveal 0.6s ease-out forwards;
    }

    @keyframes teamPointsReveal {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .result-message {
      font-size: 48px;
      font-weight: bold;
      margin: 30px 0;
      animation: popIn 0.5s ease-out;
    }

    .result-message.correct {
      color: #4CAF50;
    }

    .result-message.incorrect {
      color: #f44336;
    }

    .result-details {
      font-size: 24px;
      margin: 20px 0;
    }

    .correct-answer-display {
      font-size: 36px;
      margin: 20px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    @keyframes popIn {
      0% {
        transform: scale(0);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }

    /* Splash Screen */
    .splash-container {
      text-align: center;
      padding: 50px 0;
    }

    .splash-title {
      font-size: 3em;
      margin-bottom: 50px;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    .splash-versus {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
    }

    .splash-team {
      font-size: 2.5em;
      font-weight: bold;
      padding: 30px 50px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      min-width: 250px;
    }

    .splash-vs {
      font-size: 4em;
      font-weight: bold;
      color: #FFD700;
    }

    /* Team Tables on Game Screen */
    .team-tables {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .team-table {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .team-table-header {
      background: rgba(255, 255, 255, 0.2);
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }

    .team-players {
      padding: 10px;
    }

    .player-row {
      padding: 8px 10px;
      margin: 5px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
      transition: all 0.3s;
    }

    .player-row.answered {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      font-weight: bold;
      transform: scale(1.05);
    }

    /* Sports Scoreboard */
    .scoreboard {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 20px;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      padding: 30px;
      border-radius: 20px;
      margin: 20px 0;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .scoreboard-team {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .scoreboard-team-name {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .scoreboard-team-score {
      font-size: 72px;
      font-weight: bold;
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      margin-bottom: 20px;
    }

    .scoreboard-blitz-indicator {
      text-align: center;
      margin: 10px 0;
    }

    .scoreboard-players-table {
      width: 100%;
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 10px;
    }

    .scoreboard-players-header {
      text-align: center;
      font-size: 14px;
      font-weight: bold;
      letter-spacing: 2px;
      padding: 5px 0;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      margin-bottom: 10px;
    }

    .scoreboard-players {
      width: 100%;
    }

    .scoreboard-player {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      margin: 5px 0;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 5px;
      font-size: 14px;
    }

    .scoreboard-player-name {
      flex: 1;
    }

    .scoreboard-player-accuracy {
      font-weight: bold;
      color: #FFD700;
    }

    .scoreboard-center {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 150px;
    }

    .scoreboard-round {
      font-size: 24px;
      font-weight: bold;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      letter-spacing: 5px;
      background: linear-gradient(180deg, #ff6b6b, #ee5a6f);
      padding: 20px 15px;
      border-radius: 10px;
    }

    /* Player Leaderboard */
    .player-leaderboard {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
    }

    .player-leaderboard h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .player-lb-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      margin: 8px 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .player-lb-item.highlight {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      font-weight: bold;
      transform: scale(1.02);
    }

    .player-lb-rank {
      font-size: 24px;
      font-weight: bold;
      min-width: 40px;
    }

    .player-lb-info {
      flex: 1;
      margin: 0 15px;
    }

    .player-lb-stats {
      text-align: right;
    }

    .player-lb-score {
      font-size: 20px;
      font-weight: bold;
    }

    .player-lb-accuracy {
      font-size: 14px;
      opacity: 0.8;
    }

    /* Powerups Section */
    .powerups-section {
      text-align: center;
      margin: 20px 0;
    }

    .powerup-button {
      padding: 4px 10px;
      font-size: 14px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .blitz-button {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: #000;
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
    }

    .blitz-button:hover:not(:disabled) {
      transform: scale(1.1);
      box-shadow: 0 8px 30px rgba(255, 215, 0, 0.8);
    }

    .blitz-button:disabled {
      background: #666;
      color: #999;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Blitz Effect */
    .blitzed {
      animation: blitzPulse 0.5s ease-in-out infinite;
    }

    @keyframes blitzPulse {
      0%, 100% {
        color: #FFD700;
        text-shadow: 0 0 20px #FFD700;
      }
      50% {
        color: #FFF;
        text-shadow: 0 0 40px #FFD700, 0 0 60px #FFA500;
      }
    }

    .buttons-fadeout {
      animation: fadeOut 0.5s forwards;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    /* Blitz Notification */
    .blitz-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: #FFD700;
      padding: 30px 60px;
      border-radius: 20px;
      font-size: 36px;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
      animation: blitzNotification 2s forwards;
    }

    @keyframes blitzNotification {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      80% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
    }

    /* Blitz Indicator on Scoreboard */
    .blitz-indicator {
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 5px;
      margin-top: 5px;
    }

    .blitz-available {
      background: rgba(255, 215, 0, 0.3);
      color: #FFD700;
    }

    .blitz-used {
      background: rgba(128, 128, 128, 0.3);
      color: #999;
    }

    /* Beast Mode Button */
    .beast-button {
      background: linear-gradient(135deg, #FF4500 0%, #8B0000 100%);
      color: #FFF;
      box-shadow: 0 5px 20px rgba(255, 69, 0, 0.6);
      margin-left: 15px;
    }

    .beast-button:hover:not(:disabled) {
      transform: scale(1.1);
      box-shadow: 0 8px 30px rgba(255, 69, 0, 0.9);
    }

    .beast-button:disabled {
      background: #666;
      color: #999;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Beast Mode Effect - Fire + Glow */
    .beast-mode-active {
      position: relative;
      border: 4px solid #FF4500;
      box-shadow: 0 0 30px rgba(255, 69, 0, 0.8),
                  inset 0 0 30px rgba(255, 69, 0, 0.3);
      animation: beastGlow 1s ease-in-out infinite;
    }

    @keyframes beastGlow {
      0%, 100% {
        box-shadow: 0 0 30px rgba(255, 69, 0, 0.8),
                    inset 0 0 30px rgba(255, 69, 0, 0.3);
      }
      50% {
        box-shadow: 0 0 50px rgba(255, 140, 0, 1),
                    inset 0 0 50px rgba(255, 140, 0, 0.5);
      }
    }

    .beast-mode-active::before {
      content: 'ðŸ”¥';
      position: absolute;
      font-size: 40px;
      animation: fireFloat 2s ease-in-out infinite;
      pointer-events: none;
    }

    .beast-mode-active::after {
      content: 'ðŸ”¥';
      position: absolute;
      font-size: 40px;
      animation: fireFloat 2s ease-in-out infinite 1s;
      pointer-events: none;
    }

    .team-table.beast-mode-active::before {
      top: -20px;
      left: 10%;
    }

    .team-table.beast-mode-active::after {
      top: -20px;
      right: 10%;
    }

    @keyframes fireFloat {
      0%, 100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      25% {
        transform: translateY(-10px) scale(1.1);
        opacity: 0.9;
      }
      50% {
        transform: translateY(-20px) scale(1.2);
        opacity: 0.7;
      }
      75% {
        transform: translateY(-30px) scale(1.1);
        opacity: 0.4;
      }
      100% {
        transform: translateY(-40px) scale(0.8);
        opacity: 0;
      }
    }

    /* Beast Mode Notification */
    .beast-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: #FF4500;
      padding: 40px 80px;
      border-radius: 20px;
      font-size: 48px;
      font-weight: bold;
      text-align: center;
      z-index: 10000;
      box-shadow: 0 0 50px rgba(255, 69, 0, 0.8);
      animation: beastPopIn 0.5s ease-out;
    }

    @keyframes beastPopIn {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      50% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.2);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Name Entry Screen -->
    <div id="nameScreen" class="screen active">
      <h1>Welcome!</h1>
      <div class="input-group">
        <input type="text" id="playerName" placeholder="Enter your name" maxlength="20" />
        <button onclick="joinGame()">Join Game</button>
      </div>
    </div>

    <!-- Lobby Screen -->
    <div id="lobbyScreen" class="screen">
      <h1>Lobby</h1>
      <div id="lobbyContent">
        <h2>Waiting for game to start...</h2>
        <div id="teamSection" class="team-section" style="display: none;">
          <h3>Teams</h3>
          <div class="input-group" id="createTeamGroup">
            <input type="text" id="teamName" placeholder="Create a new team" maxlength="20" />
            <button onclick="createTeam()">Create Team</button>
          </div>
          <div class="team-list" id="teamList"></div>
        </div>
        <div id="playersList"></div>
      </div>
    </div>

    <!-- Splash Screen -->
    <div id="splashScreen" class="screen">
      <div class="splash-container">
        <h1 class="splash-title">Team Battle!</h1>
        <div class="splash-versus">
          <div class="splash-team" id="splashTeam1">Team 1</div>
          <div class="splash-vs">VS</div>
          <div class="splash-team" id="splashTeam2">Team 2</div>
        </div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
      <div class="player-header" id="playerHeader">
        <div class="player-stat">
          <div class="player-stat-label">Player</div>
          <div class="player-stat-value" id="headerPlayerName">-</div>
        </div>
        <div class="player-stat">
          <div class="player-stat-label">Team</div>
          <div class="player-stat-value" id="headerTeamName">No Team</div>
        </div>
        <div class="player-stat">
          <div class="player-stat-label">Team Score</div>
          <div class="player-stat-value" id="headerTeamScore">-</div>
        </div>
        <div class="player-stat">
          <div class="player-stat-label">Accuracy</div>
          <div class="player-stat-value" id="headerAccuracy">-</div>
        </div>
      </div>
      <div class="round-info" id="roundInfo">Round 1 of 10</div>
      <div class="question-display" id="questionDisplay">What is 5 + 3?</div>
      <div class="timer" id="timer">30</div>

      <!-- Team Tables -->
      <div class="team-tables">
        <div class="team-table" id="teamTable1">
          <div class="team-table-header" id="teamHeader1">Team 1</div>
          <div class="team-players" id="teamPlayers1"></div>
        </div>
        <div class="team-table" id="teamTable2">
          <div class="team-table-header" id="teamHeader2">Team 2</div>
          <div class="team-players" id="teamPlayers2"></div>
        </div>
      </div>

      <!-- Powerups Section -->
      <div class="powerups-section" id="powerupsSection">
        <button class="powerup-button blitz-button" id="blitzButton" onclick="useBlitz()" disabled>
          âš¡ BLITZ
        </button>
        <button class="powerup-button beast-button" id="beastButton" onclick="useBeastMode()" disabled>
          ðŸ”¥ BEAST MODE
        </button>
      </div>

      <div class="game-buttons" id="gameButtons">
        <button class="game-button" onclick="selectButton(1)">1</button>
        <button class="game-button" onclick="selectButton(2)">2</button>
        <button class="game-button" onclick="selectButton(3)">3</button>
      </div>
      <div id="trashTalkSection" style="display: none;">
        <h3>Trash Talk</h3>
        <div class="trash-talk-buttons" id="trashTalkButtons"></div>
        <div class="chat-section" id="chatMessages"></div>
      </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="screen">
      <div class="result-screen">
        <div class="round-info" id="resultRoundInfo">Round 1 of 10</div>
        <div class="correct-answer-display" id="resultCorrectAnswer">
          Correct Answer: <strong id="correctAnswerDisplay">1</strong>
        </div>
        <div class="result-teams-container">
          <div class="result-team" id="resultTeam1">
            <div class="result-team-header" id="resultTeamHeader1">Team 1</div>
            <div class="result-team-players" id="resultTeamPlayers1"></div>
            <div class="team-points-reveal" id="teamPointsReveal1"></div>
          </div>
          <div class="result-team" id="resultTeam2">
            <div class="result-team-header" id="resultTeamHeader2">Team 2</div>
            <div class="result-team-players" id="resultTeamPlayers2"></div>
            <div class="team-points-reveal" id="teamPointsReveal2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboardScreen" class="screen">
      <div class="round-info" id="leaderboardRoundInfo"></div>

      <!-- Sports Scoreboard -->
      <div class="scoreboard">
        <div class="scoreboard-team" id="scoreboardTeam1">
          <div class="scoreboard-team-name" id="scoreTeamName1">Team 1</div>
          <div class="scoreboard-team-score" id="scoreTeamScore1">0</div>
          <div class="scoreboard-blitz-indicator" id="blitzIndicator1"></div>
          <div class="scoreboard-players-table">
            <div class="scoreboard-players-header">PLAYERS</div>
            <div class="scoreboard-players" id="scoreTeamPlayers1"></div>
          </div>
        </div>

        <div class="scoreboard-center">
          <div class="scoreboard-round" id="scoreboardRound">ROUND 1</div>
        </div>

        <div class="scoreboard-team" id="scoreboardTeam2">
          <div class="scoreboard-team-name" id="scoreTeamName2">Team 2</div>
          <div class="scoreboard-team-score" id="scoreTeamScore2">0</div>
          <div class="scoreboard-blitz-indicator" id="blitzIndicator2"></div>
          <div class="scoreboard-players-table">
            <div class="scoreboard-players-header">PLAYERS</div>
            <div class="scoreboard-players" id="scoreTeamPlayers2"></div>
          </div>
        </div>
      </div>

      <!-- Player Leaderboard -->
      <div class="player-leaderboard">
        <h2>Player Rankings</h2>
        <div id="playerLeaderboardContent"></div>
      </div>

      <div class="waiting">Next round starting soon...</div>
    </div>

    <!-- Final Screen -->
    <div id="finalScreen" class="screen">
      <h1>Game Over!</h1>
      <div id="finalLeaderboard"></div>
      <button onclick="location.reload()">Play Again</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let playerId = null;
    let playerName = null;
    let config = null;
    let selectedButton = null;
    let timerInterval = null;
    let currentTimer = 0;
    let gameState = null;
    let totalAnswers = 0;
    let correctAnswers = 0;
    let roundStartTime = 0;

    // Join game
    function joinGame() {
      const nameInput = document.getElementById('playerName');
      playerName = nameInput.value.trim();
      if (!playerName) {
        alert('Please enter your name');
        return;
      }
      socket.emit('player:join', { name: playerName });
    }

    socket.on('player:joined', (data) => {
      playerId = data.playerId;
      config = data.config;
      showScreen('lobbyScreen');

      // Show team section if teams are enabled
      if (config.features.teams) {
        document.getElementById('teamSection').style.display = 'block';
      }

      // Setup trash talk if enabled
      if (config.features.trashTalk) {
        setupTrashTalk();
      }
    });

    // Game state updates
    socket.on('game:state', (state) => {
      gameState = state;
      updateLobbyPlayers(state);
      updateTeamsList(state);
      // Update player header if on game screen
      if (document.getElementById('gameScreen').classList.contains('active')) {
        updatePlayerHeader();
      }
    });

    socket.on('round:started', (data) => {
      selectedButton = null;
      roundStartTime = Date.now();

      const questionDisplay = document.getElementById('questionDisplay');
      const buttons = document.querySelectorAll('.game-button');

      // Check if this player is blitzed
      if (data.isBlitzed) {
        // Show fullscreen BLITZ notification first
        const blitzScreen = document.createElement('div');
        blitzScreen.className = 'blitz-notification';
        blitzScreen.textContent = 'âš¡ BLITZ âš¡';
        blitzScreen.style.animation = 'none'; // Don't auto-fade
        document.body.appendChild(blitzScreen);

        // After 1.5 seconds, remove blitz screen and show game screen WITHOUT question
        setTimeout(() => {
          document.body.removeChild(blitzScreen);
          showScreen('gameScreen');

          // Hide the question
          questionDisplay.style.display = 'none';

          // Show buttons normally with answers
          buttons.forEach((btn, index) => {
            btn.textContent = data.answers[index];
            btn.classList.remove('selected', 'buttons-fadeout');
            btn.disabled = false;
            btn.style.visibility = 'visible';
          });

          currentTimer = data.timerLength; // This will be 3 seconds
          updateTimerDisplay();
          startTimer();
        }, 1500);
      } else {
        // Normal round
        showScreen('gameScreen');
        questionDisplay.textContent = `What is ${data.question}?`;
        questionDisplay.classList.remove('blitzed');
        questionDisplay.style.display = 'block'; // Ensure question is visible

        buttons.forEach((btn, index) => {
          btn.textContent = data.answers[index];
          btn.classList.remove('selected', 'buttons-fadeout');
          btn.disabled = false;
          btn.style.visibility = 'visible';
        });

        currentTimer = data.timerLength;
        updateTimerDisplay();
        startTimer();
      }

      document.getElementById('roundInfo').textContent =
        `Round ${data.round} of ${data.totalRounds}`;

      // Update player header (only if not blitzed, since game screen isn't shown yet)
      if (!data.isBlitzed) {
        updatePlayerHeader();
        updateTeamTables();

        // Clear Beast Mode effects from previous round
        document.querySelectorAll('.beast-mode-active').forEach(el => {
          el.classList.remove('beast-mode-active');
        });

        // Update powerup buttons
        updateBlitzButton();
        updateBeastButton();
      }
    });

    socket.on('round:ended', (data) => {
      if (timerInterval) {
        clearInterval(timerInterval);
      }

      console.log('Round ended data:', data);
      console.log('Round scores:', data.roundScores);
      console.log('Game state:', gameState);

      // Find my result
      const myResult = data.roundScores.find(r => r.playerName === playerName);
      const isCorrect = myResult ? myResult.correct : false;
      const pointsEarned = myResult ? myResult.points : 0;

      // Track for accuracy
      if (selectedButton !== null) {
        totalAnswers++;
        if (isCorrect) {
          correctAnswers++;
        }
      }

      // Show result screen first with all player results
      showResultScreen(data.correctAnswerValue, isCorrect, pointsEarned, data.currentRound, data.totalRounds, data.roundScores);

      // After showing all results (8 players * 500ms + team reveals + buffer), show leaderboard
      setTimeout(() => {
        showScreen('leaderboardScreen');
        document.getElementById('leaderboardRoundInfo').textContent =
          `Round ${data.currentRound} of ${data.totalRounds}`;

        displayLeaderboard(data.leaderboard, 'leaderboardContent');
      }, 6500);
    });

    socket.on('game:finished', (data) => {
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      showScreen('finalScreen');
      displayLeaderboard(data.leaderboard, 'finalLeaderboard');
    });

    socket.on('game:reset', () => {
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      // Reset accuracy stats
      totalAnswers = 0;
      correctAnswers = 0;
      showScreen('lobbyScreen');
    });

    socket.on('answer:recorded', (data) => {
      // Visual feedback that answer was recorded
      selectedButton = data.buttonIndex;
      document.querySelectorAll('.game-button').forEach((btn, index) => {
        if (index + 1 === data.buttonIndex) {
          btn.classList.add('selected');
        } else {
          btn.classList.remove('selected');
        }
      });
    });

    socket.on('chat:trashTalk', (message) => {
      if (config.features.trashTalk) {
        displayTrashTalk(message);
      }
    });

    socket.on('game:splash', (data) => {
      showScreen('splashScreen');
      document.getElementById('splashTeam1').textContent = data.team1.name;
      document.getElementById('splashTeam2').textContent = data.team2.name;
    });

    socket.on('player:answered', (data) => {
      // Highlight player in team tables when they answer
      const playerElements = document.querySelectorAll(`.player-row[data-player-id="${data.playerId}"]`);
      playerElements.forEach(el => el.classList.add('answered'));
    });

    socket.on('team:error', (data) => {
      alert(data.message);
    });

    socket.on('blitz:activated', (data) => {
      // Show notification
      const notification = document.createElement('div');
      notification.className = 'blitz-notification';
      notification.textContent = `âš¡ ${data.activatedBy} (${data.activatedByTeam}) used BLITZ on ${data.targetTeam}!`;
      document.body.appendChild(notification);

      setTimeout(() => {
        document.body.removeChild(notification);
      }, 2000);

      // Check if MY team was blitzed
      const myPlayer = gameState ? gameState.players.find(p => p.id === playerId) : null;
      if (myPlayer && myPlayer.teamId === data.targetTeamId) {
        // MY TEAM GOT BLITZED - show fullscreen BLITZ then hide question
        const questionDisplay = document.getElementById('questionDisplay');

        // Clear existing interval and reset to 3 seconds
        if (timerInterval) {
          clearInterval(timerInterval);
        }
        currentTimer = 3;
        updateTimerDisplay();

        // Show fullscreen BLITZ
        const blitzScreen = document.createElement('div');
        blitzScreen.className = 'blitz-notification';
        blitzScreen.textContent = 'âš¡ BLITZ âš¡';
        blitzScreen.style.animation = 'none';
        document.body.appendChild(blitzScreen);

        // After 1.5 seconds, hide blitz screen and remove question
        setTimeout(() => {
          document.body.removeChild(blitzScreen);
          questionDisplay.style.display = 'none';
          startTimer(); // Start 3 second countdown
        }, 1500);
      }

      // Update blitz button state
      updateBlitzButton();
    });

    socket.on('blitz:error', (data) => {
      alert(data.message);
    });

    socket.on('beastMode:activated', (data) => {
      // Show notification
      const notification = document.createElement('div');
      notification.className = 'beast-notification';
      notification.innerHTML = `ðŸ”¥ ${data.activatedBy} activated<br/>BEAST MODE<br/>for ${data.teamName}! ðŸ”¥`;
      document.body.appendChild(notification);

      setTimeout(() => {
        document.body.removeChild(notification);
      }, 3000);

      // Apply Beast Mode visual effect to the team
      const myPlayer = gameState ? gameState.players.find(p => p.id === playerId) : null;
      if (myPlayer) {
        const teamTables = document.querySelectorAll('.team-table');
        teamTables.forEach(table => {
          const teamId = table.id === 'teamTable1' ? gameState.teams[0]?.id : gameState.teams[1]?.id;
          if (teamId === data.teamId) {
            table.classList.add('beast-mode-active');
          }
        });
      }

      // Update button state
      updateBeastButton();
    });

    socket.on('beastMode:error', (data) => {
      alert(data.message);
    });

    // Blitz function
    function useBlitz() {
      socket.emit('player:useBlitz');
    }

    // Beast Mode function
    function useBeastMode() {
      socket.emit('player:useBeastMode');
    }

    function updateBeastButton() {
      const beastBtn = document.getElementById('beastButton');

      // Check if we're on the game screen with a question visible
      const isOnGameScreen = document.getElementById('gameScreen').classList.contains('active');

      if (!isOnGameScreen) {
        beastBtn.disabled = true;
        beastBtn.textContent = 'ðŸ”¥ BEAST MODE';
        return;
      }

      // Check if this player has already used Beast Mode in the game
      const usedInGame = gameState && gameState.beastModeUsedInGame &&
                         gameState.beastModeUsedInGame.includes(playerId);

      if (usedInGame) {
        beastBtn.disabled = true;
        beastBtn.textContent = 'ðŸ”¥ BEAST MODE (Used)';
        return;
      }

      // Check if Beast Mode is already active this round
      const alreadyActiveThisRound = gameState && gameState.beastModeTeam;

      if (alreadyActiveThisRound) {
        beastBtn.disabled = true;
        beastBtn.textContent = 'ðŸ”¥ BEAST MODE (Active)';
      } else {
        beastBtn.disabled = false;
        beastBtn.textContent = 'ðŸ”¥ BEAST MODE';
      }
    }

    function updateBlitzButton() {
      if (!gameState) return;

      const myPlayer = gameState.players.find(p => p.id === playerId);
      if (!myPlayer || !myPlayer.teamId) return;

      const myTeam = gameState.teams.find(t => t.id === myPlayer.teamId);
      const blitzBtn = document.getElementById('blitzButton');

      if (myTeam && myTeam.blitzAvailable) {
        blitzBtn.disabled = false;
        blitzBtn.textContent = 'âš¡ BLITZ (Available)';
      } else {
        blitzBtn.disabled = true;
        blitzBtn.textContent = 'âš¡ BLITZ (Used)';
      }
    }

    // Timer
    function startTimer() {
      timerInterval = setInterval(() => {
        currentTimer--;
        updateTimerDisplay();
        if (currentTimer <= 0) {
          clearInterval(timerInterval);
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      document.getElementById('timer').textContent = currentTimer;
    }

    // Button selection
    function selectButton(buttonIndex) {
      socket.emit('player:answer', { buttonIndex });
    }

    // Team management
    function createTeam() {
      const teamNameInput = document.getElementById('teamName');
      const teamName = teamNameInput.value.trim();
      if (!teamName) {
        alert('Please enter a team name');
        return;
      }
      socket.emit('player:createTeam', { teamName });
      teamNameInput.value = '';
    }

    function joinTeam(teamId) {
      socket.emit('player:joinTeam', { teamId });
    }

    function updateLobbyPlayers(state) {
      if (document.getElementById('lobbyScreen').classList.contains('active')) {
        const playersList = document.getElementById('playersList');
        playersList.innerHTML = '<h3>Players</h3>';

        // Only show human players in lobby (no CPUs)
        const humanPlayers = state.players.filter(p => !p.isCPU);

        humanPlayers.forEach(player => {
          const div = document.createElement('div');
          div.className = 'leaderboard-item';
          div.innerHTML = `
            <span>${player.name}</span>
            <span>${player.teamId ? `Team: ${state.teams.find(t => t.id === player.teamId)?.name || ''}` : 'No team'}</span>
          `;
          playersList.appendChild(div);
        });
      }
    }

    function updateTeamsList(state) {
      if (!config || !config.features.teams) return;

      const teamList = document.getElementById('teamList');
      teamList.innerHTML = '<h4>Available Teams:</h4>';

      const myPlayer = state.players.find(p => p.id === playerId);
      const myTeamId = myPlayer?.teamId;

      // Hide create team UI if player is already in a team
      const createTeamGroup = document.getElementById('createTeamGroup');
      if (createTeamGroup) {
        createTeamGroup.style.display = myTeamId ? 'none' : 'block';
      }

      // Only show teams created by humans (no CPU teams in lobby)
      const humanTeams = state.teams.filter(t => !t.isCPU);

      humanTeams.forEach(team => {
        const div = document.createElement('div');
        div.className = 'team-item';

        // Only show human members in the list
        const humanMembers = team.members.filter(mid => {
          const p = state.players.find(player => player.id === mid);
          return p && !p.isCPU;
        });

        const memberNames = humanMembers
          .map(mid => state.players.find(p => p.id === mid)?.name || 'Unknown')
          .join(', ');

        div.innerHTML = `
          <div>
            <strong>${team.name}</strong>
            <br><small>${memberNames || 'No members yet'}</small>
          </div>
          ${!myTeamId ? `<button onclick="joinTeam('${team.id}')">Join</button>` : ''}
        `;
        teamList.appendChild(div);
      });
    }

    // Trash talk
    function setupTrashTalk() {
      document.getElementById('trashTalkSection').style.display = 'block';
      const container = document.getElementById('trashTalkButtons');
      config.trashTalkPhrases.forEach((phrase, index) => {
        const btn = document.createElement('button');
        btn.textContent = phrase;
        btn.onclick = () => sendTrashTalk(index);
        container.appendChild(btn);
      });
    }

    function sendTrashTalk(phraseIndex) {
      socket.emit('player:trashTalk', { phraseIndex });
    }

    function displayTrashTalk(message) {
      const chatMessages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'chat-message';
      div.innerHTML = `<strong>${message.playerName}:</strong> ${message.phrase}`;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Update team tables on game screen
    function updateTeamTables() {
      if (!gameState || !gameState.teams) return;

      const teams = Array.from(gameState.teams);

      teams.forEach((team, index) => {
        if (index < 2) { // Only show first 2 teams
          const headerEl = document.getElementById(`teamHeader${index + 1}`);
          const playersEl = document.getElementById(`teamPlayers${index + 1}`);

          headerEl.textContent = team.name;
          playersEl.innerHTML = '';

          team.members.forEach(memberId => {
            const player = gameState.players.find(p => p.id === memberId);
            if (player) {
              const div = document.createElement('div');
              div.className = 'player-row';
              div.setAttribute('data-player-id', player.id);
              div.textContent = player.name + (player.isCPU ? ' (CPU)' : '');
              playersEl.appendChild(div);
            }
          });
        }
      });
    }

    // Leaderboard - Sports Scoreboard
    function displayLeaderboard(leaderboard, containerId) {
      if (containerId === 'leaderboardContent') {
        // New sports scoreboard format
        updateSportsScoreboard(leaderboard);
        updatePlayerLeaderboard(leaderboard);
      } else {
        // Final screen - use same format
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        // Create simplified scoreboard for final screen
        const teams = leaderboard.teamLeaderboard || [];
        if (teams.length >= 2) {
          const div = document.createElement('div');
          div.innerHTML = `
            <h2>${teams[0].name}: ${teams[0].score} pts</h2>
            <h2>${teams[1].name}: ${teams[1].score} pts</h2>
            <h3 style="margin-top: 30px;">${teams[0].score > teams[1].score ? teams[0].name + ' WINS!' : teams[1].score > teams[0].score ? teams[1].name + ' WINS!' : 'TIE GAME!'}</h3>
          `;
          container.appendChild(div);
        }
      }
    }

    function updateSportsScoreboard(leaderboard) {
      if (!leaderboard.teamLeaderboard || leaderboard.teamLeaderboard.length < 2) return;

      const teams = leaderboard.teamLeaderboard;
      const myPlayer = gameState ? gameState.players.find(p => p.id === playerId) : null;

      // Team 1
      document.getElementById('scoreTeamName1').textContent = teams[0].name;
      document.getElementById('scoreTeamScore1').textContent = teams[0].score;

      // Blitz indicator for team 1
      const team1Data = gameState.teams.find(t => t.name === teams[0].name);
      const blitzIndicator1 = document.getElementById('blitzIndicator1');
      if (team1Data) {
        if (team1Data.blitzAvailable) {
          blitzIndicator1.innerHTML = '<div class="blitz-indicator blitz-available">âš¡ BLITZ READY</div>';
        } else {
          blitzIndicator1.innerHTML = '<div class="blitz-indicator blitz-used">âš¡ BLITZ USED</div>';
        }
      }

      // Team 2
      document.getElementById('scoreTeamName2').textContent = teams[1].name;
      document.getElementById('scoreTeamScore2').textContent = teams[1].score;

      // Blitz indicator for team 2
      const team2Data = gameState.teams.find(t => t.name === teams[1].name);
      const blitzIndicator2 = document.getElementById('blitzIndicator2');
      if (team2Data) {
        if (team2Data.blitzAvailable) {
          blitzIndicator2.innerHTML = '<div class="blitz-indicator blitz-available">âš¡ BLITZ READY</div>';
        } else {
          blitzIndicator2.innerHTML = '<div class="blitz-indicator blitz-used">âš¡ BLITZ USED</div>';
        }
      }

      // Round info
      if (gameState) {
        document.getElementById('scoreboardRound').textContent = `ROUND ${gameState.currentRound}`;
      }

      // Update player tables for each team
      [1, 2].forEach(teamIndex => {
        const teamData = teams[teamIndex - 1];
        const playersContainer = document.getElementById(`scoreTeamPlayers${teamIndex}`);
        playersContainer.innerHTML = '';

        // Get all players for this team (sorted by accuracy)
        const teamPlayers = gameState.players
          .filter(p => p.teamId === teamData.id)
          .sort((a, b) => {
            const accA = a.accuracy ? a.accuracy.percentage : 0;
            const accB = b.accuracy ? b.accuracy.percentage : 0;
            return accB - accA;
          });

        // Display each player with their accuracy
        teamPlayers.forEach(player => {
          const accuracy = player.accuracy ? player.accuracy.percentage : 0;
          const div = document.createElement('div');
          div.className = 'scoreboard-player';
          div.innerHTML = `
            <span class="scoreboard-player-name">${player.name}${player.isCPU ? ' (CPU)' : ''}</span>
            <span class="scoreboard-player-accuracy">${accuracy}%</span>
          `;
          playersContainer.appendChild(div);
        });
      });
    }

    function updatePlayerLeaderboard(leaderboard) {
      const container = document.getElementById('playerLeaderboardContent');
      container.innerHTML = '';

      const players = leaderboard.playerLeaderboard || [];

      players.forEach(player => {
        const div = document.createElement('div');
        div.className = 'player-lb-item';

        if (player.name === playerName) {
          div.classList.add('highlight');
        }

        div.innerHTML = `
          <div class="player-lb-rank">#${player.rank}</div>
          <div class="player-lb-info">
            ${player.name}${player.isCPU ? ' <span class="cpu-badge">CPU</span>' : ''}
          </div>
          <div class="player-lb-stats">
            <div class="player-lb-score">${player.score} pts</div>
          </div>
        `;
        container.appendChild(div);
      });
    }

    // Result screen - Dramatic player-by-player reveal
    function showResultScreen(correctAnswer, isCorrect, pointsEarned, currentRound, totalRounds, roundScores) {
      console.log('showResultScreen called with:', {
        correctAnswer,
        isCorrect,
        pointsEarned,
        currentRound,
        totalRounds,
        roundScores,
        gameState
      });

      // Clear any existing result content first
      document.getElementById('resultTeamPlayers1').innerHTML = '';
      document.getElementById('resultTeamPlayers2').innerHTML = '';

      // Reset team points reveal elements
      const teamPointsReveal1 = document.getElementById('teamPointsReveal1');
      const teamPointsReveal2 = document.getElementById('teamPointsReveal2');
      teamPointsReveal1.classList.remove('show');
      teamPointsReveal2.classList.remove('show');
      teamPointsReveal1.textContent = '';
      teamPointsReveal2.textContent = '';

      document.getElementById('resultRoundInfo').textContent =
        `Round ${currentRound} of ${totalRounds}`;

      document.getElementById('correctAnswerDisplay').textContent = correctAnswer;

      // Get teams from gameState - with validation
      if (!gameState || !gameState.teams || gameState.teams.length < 2) {
        console.error('Invalid gameState or teams:', gameState);
        return;
      }

      const teams = Array.from(gameState.teams);
      console.log('Teams:', teams);

      // Organize players by team
      const teamPlayers = {};
      teams.forEach(team => {
        teamPlayers[team.id] = [];
      });

      // Group round scores by team
      if (!roundScores || !Array.isArray(roundScores)) {
        console.error('roundScores is not an array:', roundScores);
        return;
      }

      roundScores.forEach(score => {
        console.log('Processing score:', score);
        if (score.teamId && teamPlayers[score.teamId]) {
          teamPlayers[score.teamId].push(score);
        } else {
          console.warn('Score teamId not found in teamPlayers:', score.teamId, 'Available teams:', Object.keys(teamPlayers));
        }
      });

      console.log('Team players organized:', teamPlayers);

      // Clear previous round results
      document.getElementById('resultTeamPlayers1').innerHTML = '';
      document.getElementById('resultTeamPlayers2').innerHTML = '';

      // Set up team headers
      teams.forEach((team, index) => {
        if (index < 2) {
          const headerEl = document.getElementById(`resultTeamHeader${index + 1}`);
          const playersContainer = document.getElementById(`resultTeamPlayers${index + 1}`);

          if (headerEl && playersContainer) {
            headerEl.textContent = team.name;

            // Create placeholder elements for each player
            const players = teamPlayers[team.id] || [];
            console.log(`Creating ${players.length} player divs for team ${team.name}`);

            players.forEach(player => {
              const div = document.createElement('div');
              div.className = 'result-player';
              div.setAttribute('data-player-id', player.playerId);
              div.innerHTML = `
                <div class="result-player-name">${player.playerName}</div>
                <div class="result-player-result">
                  <div class="result-player-status"></div>
                  <div class="result-player-points"></div>
                </div>
              `;
              playersContainer.appendChild(div);
            });
          } else {
            console.error('Could not find result containers for team', index + 1);
          }
        }
      });

      showScreen('resultScreen');

      // Dramatic reveal: one player at a time
      let allPlayers = [];
      teams.forEach(team => {
        const players = teamPlayers[team.id] || [];
        allPlayers = allPlayers.concat(players);
      });

      console.log('Total players to reveal:', allPlayers.length);

      // Reveal players sequentially
      allPlayers.forEach((player, index) => {
        setTimeout(() => {
          const playerDiv = document.querySelector(`[data-player-id="${player.playerId}"]`);
          console.log(`Revealing player ${index}:`, player.playerName, playerDiv ? 'found' : 'NOT FOUND');

          if (playerDiv) {
            // Remove any previous classes
            playerDiv.classList.remove('correct', 'incorrect', 'reveal');

            // Force a reflow to restart animation
            void playerDiv.offsetWidth;

            // Add correct/incorrect class
            playerDiv.classList.add(player.correct ? 'correct' : 'incorrect');

            // Update status and points
            const statusEl = playerDiv.querySelector('.result-player-status');
            const pointsEl = playerDiv.querySelector('.result-player-points');

            if (statusEl && pointsEl) {
              if (player.correct) {
                statusEl.textContent = 'âœ“ Correct';
                statusEl.style.color = '#4CAF50';
              } else {
                statusEl.textContent = 'âœ— Wrong';
                statusEl.style.color = '#F44336';
              }

              pointsEl.textContent = `+${player.points} pts`;

              // Show Beast Mode multiplier if applicable
              if (player.beastModeActive) {
                const multiplierText = player.beastModeMultiplier === 2 ? ' (2x BEAST!)' :
                                       player.beastModeMultiplier === 0 ? ' (0x BEAST)' : '';
                pointsEl.textContent += multiplierText;
              }
            }

            // Trigger reveal animation
            playerDiv.classList.add('reveal');
          }
        }, index * 500); // 500ms delay between each player
      });

      // After all players are revealed, show team points
      const allPlayersRevealTime = allPlayers.length * 500;

      // Calculate total points each team earned this round
      const teamRoundPoints = {};
      teams.forEach(team => {
        teamRoundPoints[team.id] = 0;
      });

      roundScores.forEach(score => {
        if (score.teamId && teamRoundPoints[score.teamId] !== undefined) {
          teamRoundPoints[score.teamId] += score.points;
        }
      });

      // Reveal team 1 points
      setTimeout(() => {
        const team1 = teams[0];
        const points1 = teamRoundPoints[team1.id] || 0;
        teamPointsReveal1.textContent = `Round Points: +${points1}`;
        teamPointsReveal1.classList.add('show');
      }, allPlayersRevealTime + 500);

      // Reveal team 2 points
      setTimeout(() => {
        const team2 = teams[1];
        const points2 = teamRoundPoints[team2.id] || 0;
        teamPointsReveal2.textContent = `Round Points: +${points2}`;
        teamPointsReveal2.classList.add('show');
      }, allPlayersRevealTime + 1200);
    }

    // Update player header
    function updatePlayerHeader() {
      if (!gameState) return;

      // Update player name
      document.getElementById('headerPlayerName').textContent = playerName;

      // Find my player data
      const myPlayer = gameState.players.find(p => p.id === playerId);

      if (myPlayer) {
        // Update team info
        if (myPlayer.teamId) {
          const myTeam = gameState.teams.find(t => t.id === myPlayer.teamId);
          if (myTeam) {
            document.getElementById('headerTeamName').textContent = myTeam.name;
            document.getElementById('headerTeamScore').textContent = myTeam.score;
          } else {
            document.getElementById('headerTeamName').textContent = 'No Team';
            document.getElementById('headerTeamScore').textContent = '-';
          }
        } else {
          document.getElementById('headerTeamName').textContent = 'No Team';
          document.getElementById('headerTeamScore').textContent = '-';
        }

        // Update accuracy
        if (totalAnswers > 0) {
          const accuracy = Math.round((correctAnswers / totalAnswers) * 100);
          document.getElementById('headerAccuracy').textContent = `${accuracy}%`;
        } else {
          document.getElementById('headerAccuracy').textContent = '-';
        }
      }
    }

    // Screen management
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    // Allow Enter key to submit name
    document.getElementById('playerName').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') joinGame();
    });

    document.getElementById('teamName').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') createTeam();
    });
  </script>
</body>
</html>
